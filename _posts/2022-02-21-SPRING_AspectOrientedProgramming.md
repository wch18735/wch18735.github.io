---
title: "[Spring] Aspect Oriented Programming"
excerpt: "aspect oriented programming"
date: 2022-02-21
layout: single
classes: wide
category:
    - spring
tag:
    - spring
    - aop
    - aspectj
    - jdbc
author: 1FeS
comments: true
---

# AOP 개요

어플리케이션 상에서 기능은 핵심 기능과 부가 기능으로 나눌 수 있다. 업무 로직을 포함하는 기능을 핵심 기능(Core Concerns) 라고 하며 핵심기능을 도와주는 부가적인 기능(로깅, 보안 등)을 부가 기능(Cross-cutting Concerns)이라고 부른다.

AOP는 어플리케이션에서의 관심사의 분리(기능 분리)를 뜻한다. 즉, 핵심적인 기능에서 부가 기능을 분리해 따로 관리할 수 있도록 하는 것이다. 이렇게 분리한 부가 기능을 애스펙트 (Aspect)라는 모듈 형태로 만들어 설계하고 관리하는 것을 AOP라 한다.

OOP를 적용해도 핵심 기능에서 부가 기능을 쉽게 분리된 모듈로 작성하기 어려운 문제점을 AOP가 해결해 준다고 볼 수 있다. AOP는 부가 기능을 애스펙트(Aspect)로 정의해 핵심 기능에서 부가 기능을 분리할 수 있도록 도와 객체지향적 가치를 지킬 수 있도록 돕는다.

## 관점(Aspect)

관점은 부가 기능을 정의한 코드인 어드바이스(Advice)와 어드바이스를 어디에 적용할지 결정하는 포인트컷(Point Cut)을 합친 개념이다.

> Advice + Point Cut = Aspect

AOP 개념을 적용하면 핵심 기능 코드 사이에 침투된 부가 기능을 독립적인 관점들로 구분해 낼 수 있다. 이렇게 구분된 부가 기능 관점을 런타임 시에 필요한 위치에 동적으로 참여하게 만들 수 있다.

## AOP 용어

- 타깃 (Target) : 핵심 기능을 담고있는 모듈로, 타깃은 부가 기능을 부여할 대상이 됨
- 어드바이스 (Advice) : 어드바이스는 타깃에 제공할 부가기능을 담고있는 모듈
- 조인 포인트 (Join Point) : 어드바이스가 적용될 수 있는 위치를 뜻한다. 타깃 객체가 구현한 인터페이스의 모든 메서드는 조인 포인트가 된다.
- 포인트컷 (Point Cut) : 어드바이스를 적용할 타깃의 메서드를 선별하는 정규 표현식이다. 포인트컷 표현식은 execution 으로 시작하고, 메서드의 Signature 를 비교하는 방법을 주로 이용한다.
- 어드바이저 (Advisor) : 어드바이저는 Spring AOP 에서만 사용되는 특별한 용어로 `어드바이스 + 포인트 컷` 을 뜻한다.
- 위빙 (Weaving) : 위빙은 포인트컷에 의해서 결정된 타깃의 조인 포인트에 부가 기능을 삽입하는 과정을 뜻한다. 위빙은 AOP가 핵심 기능(타깃)의 코드에 영향을 주지 않으면서 필요한 부가기능(어드바이스)을 추가할 수 있도록 해주는 핵심적 처리 과정이다.

위 용어들을 그림으로 정리하면 아래와 같이 표현할 수 있다.

<img src="/_img/2022-02-21/aop_concept.png">

## Spring AOP 특징

Spring은 프록시(Proxy) 기반 AOP를 지원한다. 타깃 객체에 대한 프록시를 만들어 제공하는 형태이다. 타깃을 감싸는 프록시는 Runtime 단계에 생성되며, 어드바이스를 타깃 객체에 적용하면서 생성되는 객체다.

이렇게 생성된 프록시(Proxy)는 호출을 가로챈다. 이를 Intercept 라고 한다. 프록시는 타깃 객체에 대한 호출을 가로챈 다음 어드바이스의 부가기능 로직을 수행하고 난 후 타깃의 핵심기능 로직을 호출한다. 반대로 타깃의 핵심기능 로직 메서드를 호출한 후 부가기능을 수행하는 경우도 있다. `@Before` 와  `@After` 로 지정할 수 있다.

<img src="/_img/2022-02-21/aop_proxy.png">

Spring은 동적 프록시를 기반으로 AOP를 구현한다. 따라서 Spring AOP는 메서드 조인 포인트만 지원한다. 즉, 핵심기능(타깃)의 메서드가 호출되는 런타임 시점에만 부가기능(어드바이스)을 적용할 수 있다. 반면 AspectJ 같은 고급 AOP 프레임워크를 사용하면 객체 생성, 필드값 조회 및 조작, Static 메서드 호출 및 초기화 등 다양한 작업에 부가 기능을 적용할 수 있다.

